<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://*.jsdelivr.net; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self';">
    <meta name="description" content="FastAPI Pulse Dashboard - Check your API's vital signs with instant health monitoring">
    <title>FastAPI Pulse</title>
    
    <!-- Preload critical resources -->
    <link rel="preload" href="css/dashboard.css" as="style" crossorigin>
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/dashboard.css">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ’—</text></svg>">
</head>
<body>
    <!-- Skip link for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Header -->
    <header class="header" role="banner">
        <h1>ðŸ’— FastAPI Pulse</h1>
        <p>Check your API's vital signs - instant health monitoring that just works</p>
    </header>
    
    <!-- Main content -->
    <main id="main-content" class="container" role="main">
        <!-- Refresh controls -->
        <section class="refresh-controls" aria-label="Dashboard controls">
            <div>
                <button 
                    class="refresh-button" 
                    type="button"
                    aria-label="Refresh metrics data"
                    title="Refresh metrics (Ctrl+R)"
                >
                    ðŸ”„ Refresh Now
                </button>
                <span id="lastUpdated" style="margin-left: 1rem; color: var(--color-neutral);"></span>
            </div>
            <div class="auto-refresh">
                <label for="autoRefresh">
                    <input 
                        type="checkbox" 
                        id="autoRefresh" 
                        checked
                        aria-describedby="autoRefreshDesc"
                    > 
                    Auto-refresh (30s)
                </label>
                <span id="autoRefreshDesc" class="sr-only">
                    Automatically refresh metrics every 30 seconds
                </span>
            </div>
        </section>
        
        <!-- Error message container -->
        <div id="errorContainer"></div>
        
        <!-- SLA Compliance Section -->
        <section class="chart-container" aria-labelledby="sla-heading">
            <h2 id="sla-heading">ðŸ“Š SLA Compliance Status</h2>
            <div class="sla-grid" id="slaGrid" role="region" aria-label="SLA compliance metrics">
                <!-- SLA items will be populated here -->
            </div>
        </section>
        
        <!-- Key Metrics Section -->
        <section aria-labelledby="metrics-heading">
            <h2 id="metrics-heading" class="sr-only">Key Performance Metrics</h2>
            <div class="metrics-grid" id="metricsGrid" role="region" aria-label="Performance metrics cards">
                <!-- Metric cards will be populated here -->
            </div>
        </section>
        
        <!-- Response Time Chart Section -->
        <section class="chart-container" aria-labelledby="chart-heading">
            <h2 id="chart-heading">ðŸ“ˆ Response Time Trends</h2>
            <div id="chartContainer" style="position: relative; height: 300px; width: 100%;" role="img" aria-label="Response time trends chart">
                <!-- Chart will be initialized here -->
            </div>
        </section>
        
        <!-- Endpoints Performance Table Section -->
        <section aria-labelledby="endpoints-heading">
            <div id="endpointsContainer">
                <!-- Endpoints table will be populated here -->
            </div>
        </section>
    </main>
    
    <!-- Screen reader only styles -->
    <style>
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
    
    <!-- Dashboard JavaScript - ES6 Modules -->
    <script type="module">
        // Import and initialize dashboard
        import { PerformanceDashboard } from './js/dashboard.js';
        
        // Configuration can be passed here
        const config = {
            refreshInterval: 30000,
            maxRetries: 3,
            enableAutoRefresh: true,
            chartConfig: {
                maxDataPoints: 20,
                updateAnimation: false
            }
        };
        
        // Initialize dashboard
        window.performanceDashboard = new PerformanceDashboard(config);
        
        // Error handling for module loading
        window.addEventListener('error', (event) => {
            if (event.filename && event.filename.includes('dashboard.js')) {
                console.error('Failed to load dashboard modules:', event.error);
                document.getElementById('errorContainer').innerHTML = `
                    <div class="error-message">
                        Failed to load dashboard. Please refresh the page or check your browser compatibility.
                    </div>
                `;
            }
        });
        
        // Initialize when ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                window.performanceDashboard.init().catch(error => {
                    console.error('Dashboard initialization failed:', error);
                });
            });
        } else {
            window.performanceDashboard.init().catch(error => {
                console.error('Dashboard initialization failed:', error);
            });
        }
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (window.performanceDashboard) {
                window.performanceDashboard.destroy();
            }
        });
    </script>
    
    <!-- Fallback for browsers without ES6 modules support -->
    <noscript>
        <div style="padding: 2rem; text-align: center; background: #fff5f5; border: 1px solid #feb2b2; border-radius: 8px; margin: 2rem; color: #742a2a;">
            <h2>JavaScript Required</h2>
            <p>This dashboard requires JavaScript to function. Please enable JavaScript in your browser settings.</p>
        </div>
    </noscript>
</body>
</html>